<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Novel Editor - Hybrid Auth</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
</head>
<body>
	<div id="mobileOverlay" class="mobile-overlay"></div>
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <h2 id="authTitle">로그인</h2>
            <p style="color:#666; font-size:13px; margin-bottom:20px;">
                웹소설 에디터에 오신 것을 환영합니다.
            </p>
            
            <div id="signupFields" style="display:none;">
                <input type="text" id="nicknameInput" placeholder="작가명 (닉네임)" class="login-input">
            </div>

            <input type="text" id="emailInput" placeholder="아이디 (영문/숫자)" class="login-input">
            <input type="password" id="passwordInput" placeholder="비밀번호 (6자리 이상)" class="login-input">
            
            <div id="signupConfirmField" style="display:none;">
                <input type="password" id="confirmPasswordInput" placeholder="비밀번호 확인" class="login-input">
            </div>
            
            <p id="loginMessage" class="error-msg"></p>

            <button id="btnAuthAction" class="btn-login primary">로그인</button>
            
            <div class="toggle-area">
                <span id="toggleText">계정이 없으신가요?</span>
                <button id="btnToggleMode" class="btn-text">회원가입</button>
            </div>

            <div class="divider"></div>

            <button id="btnGuest" class="btn-login secondary">비로그인으로 시작하기</button>
            
            <p id="btnShowInfo" class="info-link">💡 로그인과 비로그인의 차이는?</p>
        </div>
    </div>

    <div id="infoModal" class="info-overlay" style="display:none;">
        <div class="info-box">
            <h3>서비스 이용 안내</h3>
            
            <div class="info-content">
                <div class="info-item member">
                    <h4>🔒 회원가입 (권장)</h4>
                    <ul>
                        <li><strong>클라우드 동기화:</strong> 파이어베이스 서버에 안전하게 저장되어 데이터 분실 위험이 없습니다.</li>
                        <li><strong>멀티 디바이스:</strong> PC, 노트북, 태블릿 어디서든 이어서 작성할 수 있습니다.</li>
                        <li><strong>보안 암호화:</strong> 비밀번호는 강력하게 암호화되어 관리자도 알 수 없습니다.</li>
                    </ul>
                </div>
                
                <div class="info-item guest">
                    <h4>💻 비로그인 (로컬)</h4>
                    <ul>
                        <li><strong>로컬 저장:</strong> 작성한 내용이 현재 사용하는 브라우저에만 저장됩니다.</li>
                        <li><strong>주의사항:</strong> 인터넷 기록(캐시)을 삭제하거나 기기를 변경하면 데이터가 사라질 수 있습니다.</li>
                        <li><strong>간편함:</strong> 별도 가입 절차 없이 즉시 이용 가능합니다.</li>
                    </ul>
                </div>
            </div>

            <button id="btnCloseInfo" class="btn-close-info">확인했습니다</button>
        </div>
    </div>

    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="header-left">
                <button id="libraryHomeBtn" class="btn-home" title="내 서재로 이동">🏠</button>
                <h3 id="sidebarTitle">내 서재</h3>
            </div>
            <button class="add-btn" id="sidebarActionBtn" title="추가">+</button>
        </div>
        <ul class="sidebar-list" id="sidebarList"></ul>
<div class="sidebar-footer">
            <div id="userInfoDisplay" style="margin-bottom:5px; font-weight:bold; color:#4a90e2; font-size:13px;"></div>
            
            <span id="sidebarStatus" style="display:block; font-size:11px; color:#999; margin-bottom:8px; min-height:16px;"></span>
            
            <button id="btnLogout" class="btn-logout">로그아웃</button>
	<div id="versionDisplay" class="version-text"></div>
        </div>
    </aside>

<main class="main-area">
        <div class="top-bar">
            <button id="btnMobileMenu" class="btn-tool mobile-only" style="margin-right:10px;">☰</button>

 <div class="toolbar-group">
        <button onclick="window.performSave()" class="btn-tool primary" title="즉시 저장">💾 <span class="desktop-only">저장</span></button>
        <div class="autosave-control">
            <span class="label">자동</span>
            <input type="number" id="autoSaveIntervalInput" value="3" min="1">
            <span class="unit">분</span>
        </div>
        <div class="save-status">
            <span class="unsaved-dot" id="unsavedDot"></span>
            <span id="lastSavedDisplay" class="status-text">준비됨</span>
        </div>
    </div>

    <div class="toolbar-group" style="position: relative;">
        <button id="btnSettings" class="btn-tool">줄바꿈</button>
        
        <div id="settingsPopup" class="settings-popup">
            <div class="popup-row">
                <span class="popup-label">줄바꿈 방식</span>
                <select id="lineBreakOption" class="dropdown">
                    <option value="1">엔터 1번</option>
                    <option value="2">엔터 2번</option>
                </select>
            </div>
            <div class="popup-row">
                <label class="checkbox-label" style="justify-content: space-between; width: 100%;">
                    <span>(...) 후 띄어쓰기 무시</span>
                    <input type="checkbox" id="ignoreEllipsis" checked>
                </label>
            </div>
            <hr class="popup-divider">
            <button onclick="window.autoLineBreak()" class="btn-tool full-width">↵ 줄바꿈 일괄 정리 실행</button>
        </div>
    </div>

    <div class="toolbar-group right">
        <button id="btnMoreMenu" class="btn-tool icon-btn mobile-toggle-btn">⋮</button>

        <div id="rightToolbarItems" class="right-items-wrapper">
            <button onclick="window.toggleMemoPanel()" class="btn-tool icon-btn" title="메모장">📝</button>
            <div class="v-divider"></div>
            <button onclick="window.toggleHtmlMode()" class="btn-tool code-btn" title="HTML 모드">&lt;/&gt;</button>
            
            <div class="export-group" style="display:flex; gap:2px;">
                <button onclick="window.downloadAll('txt')" class="btn-tool">📄 TXT</button>
                <button onclick="window.downloadAll('docx')" class="btn-tool" style="color:#2b579a; font-weight:bold;">📘 DOCX</button>
            </div>
            <div class="v-divider"></div>
<button onclick="window.saveSnapshot()" class="btn-tool" title="새 기록으로 저장 (박제)">📸 기록저장</button>
<button onclick="window.openSnapshotList()" class="btn-tool" title="저장된 기록 보기">🕰️ 타임머신</button>
            <button onclick="window.backupData()" class="btn-tool">☁️ 백업</button>
            <button onclick="window.toggleDarkMode()" id="themeBtn" class="btn-tool icon-btn">🌙</button>
            
            <input type="file" id="fileInput" accept=".txt,.docx" style="display:none">
            <input type="file" id="backupInput" accept=".json" style="display:none">
            
            <button onclick="document.getElementById('fileInput').click()" class="btn-tool icon-btn" title="파일 열기">📂</button>
            <button onclick="document.getElementById('backupInput').click()" class="btn-tool icon-btn" title="백업 복원">♻️</button>
        </div>
    </div>
</div>

        <div class="editor-wrapper" id="editorWrapper">
            <input type="text" id="titleInput" class="chapter-title-input" placeholder="제목을 입력하세요">
<div class="format-toolbar" id="formatToolbar">
    <div class="format-group">
        <button class="btn-format" onclick="window.execCmd('bold')"><b>B</b></button>
        <button class="btn-format" onclick="window.execCmd('italic')"><i>I</i></button>
        <button class="btn-format" onclick="window.execCmd('underline')"><u>U</u></button>
        <button class="btn-format" onclick="window.execCmd('strikeThrough')"><s>S</s></button>
    </div>
    
    <div class="v-divider small"></div>

    <div class="symbol-group" id="symbolGroup">
        </div>

    <button class="btn-edit-symbol" onclick="window.openSymbolEditor()" title="기호 편집">✏️</button>
</div>

<div id="symbolEditModal" class="search-modal" style="display:none; height:auto;">
    <div class="modal-header">
        <span>자주 쓰는 기호 설정</span>
        <button onclick="window.closeSymbolEditor()" class="btn-close-modal">×</button>
    </div>
    <div class="modal-body">
        <p style="font-size:12px; color:#666; margin-bottom:8px;">
            콤마(,)로 구분해서 입력하세요.<br>
            2글자(예: 「」)는 앞뒤로 감싸고, 1글자는 그냥 입력됩니다.
        </p>
        <textarea id="symbolInput" style="width:100%; height:80px; padding:8px; border:1px solid #ddd; border-radius:4px; resize:none; font-family:monospace;"></textarea>
        <button onclick="window.saveCustomSymbols()" class="btn-replace" style="margin-top:10px;">저장 및 적용</button>
    </div>
</div>

            <div class="editor-scroll-area">
                <div id="mainEditor" class="editor" contenteditable="true" placeholder="여기에 소설을 작성하세요..."></div>
                <textarea id="htmlSourceEditor" class="html-editor" style="display:none;"></textarea>
            </div>
        </div>

        <div class="bottom-panel">
            <div class="goal-container">
                <div class="goal-info">
                    <select id="goalTypeSelect" class="goal-select">
                        <option value="space">공포</option>
                        <option value="nospace">공제</option>
                    </select>
                    <span class="label">목표:</span>
                    <input type="number" id="targetCountInput" value="5000" step="500" class="goal-input">
                    <span id="goalPercentage" class="percent-text">0%</span>
                </div>
                <div class="progress-track">
                    <div id="goalProgressBar" class="progress-fill" style="width: 0%;"></div>
                </div>
            </div>
            <div class="status-bar">
                <button onclick="window.toggleSearchModal()" class="btn-status-tool">🔍 찾기/바꾸기</button>
                <span id="modeDisplay" class="mode-text"></span>
                <div class="count-info">
                    <span>공백 포함 <strong id="charCount">0</strong>자</span>
                    <span class="divider">|</span>
                    <span>공백 제외 <strong id="charCountNoSpace">0</strong>자</span>
                </div>
            </div>
        </div>
    </main>

    <aside id="memoPanel" class="memo-panel">
        <div class="panel-header">
            <h4>📝 메모장</h4>
            <button onclick="window.toggleMemoPanel()" class="btn-close">×</button>
        </div>
        <textarea id="memoTextarea" class="memo-content" placeholder="이 소설의 설정, 아이디어를 적어두세요."></textarea>
    </aside>

    <div id="searchModal" class="search-modal" style="display:none;">
        <div class="modal-header">
            <span>찾기 및 바꾸기</span>
            <button onclick="window.toggleSearchModal()" class="btn-close-modal">×</button>
        </div>
        <div class="modal-body">
            <input type="text" id="findInput" placeholder="찾을 내용">
            <input type="text" id="replaceInput" placeholder="바꿀 내용">
            <button onclick="window.findAndReplace()" class="btn-replace">모두 바꾸기</button>
        </div>
    </div>
<div id="historyModal" class="login-overlay" style="display:none; z-index: 5000;">
    <div class="login-box" style="width: 400px; text-align:left;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
            <h3 style="margin:0;">🕰️ 클라우드 타임머신</h3>
            <button onclick="window.closeHistoryModal()" class="btn-close" style="font-size:24px;">×</button>
        </div>
        <p style="font-size:12px; color:#666; margin-bottom:15px;">
            게시판처럼 저장된 과거 기록들입니다. 원하는 시점으로 되돌릴 수 있습니다.
        </p>
        <div id="snapshotList" style="height: 300px; overflow-y: auto; border: 1px solid #eee; border-radius: 4px; background: #fafafa;">
            </div>
    </div>
</div>

    <script type="module" src="script.js"></script>
</body>
</html>